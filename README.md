<div class="markdown prose w-full break-words dark:prose-invert light"><h1>README.txt</h1><h2>Oracle Database Restore Script</h2><h3>Overview</h3><p>This script is designed to restore an Oracle database from an AWS S3 backup. It is intended for use by Oracle administrators and should be executed by the <code>oracle</code> user. The script includes various checks and processes to ensure a smooth and secure restoration.</p><h3>Script Details</h3><ul><li><strong>Filename:</strong> restoreDB.sh</li><li><strong>Location:</strong> /opt/restoreDB/restoreDB.sh</li><li><strong>Execution:</strong> <code>sh /opt/restoreDB/restoreDB.sh &lt;key option&gt;</code></li></ul><h3>Version Information</h3><ul><li><strong>Version:</strong> 1.0</li><li><strong>Date:</strong> 2024-02-22</li><li><strong>Author:</strong> adasilva</li></ul><h3>Prerequisites</h3><ol><li>Oracle software installed and configured.</li><li>AWS S3 bucket with the necessary backup files.</li><li>Proper permissions to execute the script as the <code>oracle</code> user.</li><li>OpenSSL installed for password encryption and decryption.</li><li>Properly configured RMAN and Oracle environment.</li></ol><h3>Environment Variables</h3><ul><li><code>ORACLE_HOME</code>: Path to the Oracle home directory.</li><li><code>GRID_HOME</code>: Path to the Grid home directory.</li><li><code>SQL</code>: Path to the SQL*Plus executable.</li><li><code>WORK_DIR</code>: Working directory for the script.</li><li><code>LOG</code>: Log file path.</li><li><code>HTMLFILE</code>: HTML log file path.</li><li><code>LOG_LAST_EXEC_TIME</code>: Path to the last execution time log file.</li><li><code>RMAN</code>: Path to the RMAN executable.</li><li><code>MASTERKEY</code>: Master password for decrypting stored passwords.</li></ul><h3>Features</h3><ul><li><strong>Check for Running Jobs:</strong> Ensures no other instances of the script are running.</li><li><strong>Directory Checks:</strong> Verifies necessary directories exist and clears old logs.</li><li><strong>User Validation:</strong> Ensures the script is run by the <code>oracle</code> user.</li><li><strong>Logging:</strong> Logs messages with timestamps for tracking progress and issues.</li><li><strong>Encrypted Passwords:</strong> Utilizes OpenSSL for encrypting and decrypting passwords.</li><li><strong>Database Shutdown:</strong> Shuts down running databases before starting the restore.</li><li><strong>ASM Cleanup:</strong> Removes database files from ASM disk groups.</li><li><strong>Directory Cleanup and Creation:</strong> Cleans and recreates necessary directories.</li><li><strong>RMAN Restoration:</strong> Performs the actual database restoration using RMAN.</li><li><strong>Execution Time Logging:</strong> Logs the total execution time for the restore operation.</li><li><strong>Database Status Check:</strong> Verifies the database is successfully restored and open in <code>READ WRITE</code> mode.</li></ul><h3>Usage</h3><ol><li><p><strong>Execute the Script:</strong></p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span>sh</span><div class="flex items-center"><span class="" data-state="closed"><button class="flex gap-1 items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg></button></span></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-sh">sh /opt/restoreDB/restoreDB.sh
</code></div></div></pre></li><li><p><strong>Follow the Prompts:</strong></p><ul><li>The script will display a list of databases with their last execution time.</li><li>Enter the key of the database to restore.</li><li>Confirm the restoration by typing <code>Y</code>.</li></ul></li><li><p><strong>Logs:</strong></p><ul><li>Check the log file for details: <code>/opt/restoreDB/log/restoreDB.log</code></li><li>HTML log file for more formatted output: <code>/opt/restoreDB/log/restoreDB.html</code></li></ul></li></ol><h3>Troubleshooting</h3><ul><li><p><strong>Errors During Execution:</strong></p><ul><li>Check the log file for specific error messages.</li><li>Ensure all prerequisites are met.</li><li>Verify the encrypted password files are correctly placed and readable.</li></ul></li><li><p><strong>Database Not Starting:</strong></p><ul><li>Verify the database files are correctly restored.</li><li>Check Oracle alert logs for specific errors.</li></ul></li></ul><h3>Security Notes</h3><ul><li><strong>Password Encryption:</strong><ul><li>The script uses OpenSSL for encrypting and decrypting passwords.</li><li>Ensure the <code>MASTERKEY</code> is securely stored and not hardcoded in the script.</li></ul></li></ul><h3>Contact</h3><p>For issues and support, contact the database administrator or script author.</p><hr><h3>Example Workflow</h3><ol><li><strong>Run the Script:</strong><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span>sh</span><div class="flex items-center"><span class="" data-state="closed"><button class="flex gap-1 items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg></button></span></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-sh">sh /opt/restoreDB/restoreDB.sh
</code></div></div></pre></li><li><strong>Select the Database to Restore:</strong><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"><button class="flex gap-1 items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg></button></span></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-sql">Key  DB Name  DB Id         <span class="hljs-keyword">Last</span> <span class="hljs-keyword">Exec</span> <span class="hljs-type">Time</span>
<span class="hljs-comment">---- -------  ------------  --------------</span>
<span class="hljs-number">1</span>    EARTH    <span class="hljs-number">1111111111</span>    <span class="hljs-number">2024</span><span class="hljs-number">-02</span><span class="hljs-number">-21</span> <span class="hljs-number">12</span>:<span class="hljs-number">34</span>:<span class="hljs-number">56</span>
<span class="hljs-number">2</span>    MARS     <span class="hljs-number">2222222222</span>    <span class="hljs-number">2024</span><span class="hljs-number">-02</span><span class="hljs-number">-20</span> <span class="hljs-number">11</span>:<span class="hljs-number">23</span>:<span class="hljs-number">45</span>
<span class="hljs-number">3</span>    VENUS    <span class="hljs-number">3333333333</span>    <span class="hljs-number">2024</span><span class="hljs-number">-02</span><span class="hljs-number">-19</span> <span class="hljs-number">10</span>:<span class="hljs-number">12</span>:<span class="hljs-number">34</span>
Enter the key <span class="hljs-keyword">of</span> the item <span class="hljs-keyword">to</span> be restored: <span class="hljs-number">1</span>
</code></div></div></pre></li><li><strong>Confirm Restoration:</strong><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"><button class="flex gap-1 items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg></button></span></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-vbnet">You selected: EARTH <span class="hljs-keyword">with</span> DB ID: <span class="hljs-number">1111111111</span>
<span class="hljs-keyword">Do</span> you want <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span> <span class="hljs-keyword">with</span> restoration? (Y/N): Y
</code></div></div></pre></li></ol><h3>End of Script</h3></div>
